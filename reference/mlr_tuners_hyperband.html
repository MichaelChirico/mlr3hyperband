<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Tuner using the Hyperband algorithm — mlr_tuners_hyperband • mlr3hyperband</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<link href="../extra.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Tuner using the Hyperband algorithm — mlr_tuners_hyperband" />
<meta property="og:description" content="TunerHyperband class that implements hyperband tuning. Hyperband is a
budget oriented-procedure, weeding out suboptimal performing configurations
early in a sequential training process, increasing tuning efficiency as a
consequence.
For this, several brackets are constructed with an associated set of
configurations for each bracket. Each bracket as several stages. Different
brackets are initialized with different amounts of configurations and
different budget sizes. To get an idea of how the bracket layout looks like
for a given argument set, please have a look in the details.
To identify the budget for evaluating hyperband, the user has to specify
explicitly which hyperparameter of the learner influences the budget by
tagging a single hyperparameter in the paradox::ParamSet with &quot;budget&quot;.
An alternative approach using subsampling and pipelines is described below.
Naturally, hyperband terminates once all of its brackets are evaluated, so a
bbotk::Terminator in the tuning instance acts as an upper bound and should
be only set to a low value if one is unsure of how long hyperband will take
to finish under the given settings." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a href="https://mlr-org.com"><img src="https://raw.githubusercontent.com/mlr-org/mlr3/master/man/figures/logo.png" id="hexlogo" alt="mlr-org" /></a>
        <a class="navbar-brand" href="../index.html">mlr3hyperband <small>v0.0.0.9000</small></a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/mlr-org/mlr3hyperband/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.slack.com">
    <span class="fab fa fab fa-slack"></span>
     
  </a>
</li>
<li>
  <a href="https://stackoverflow.com/questions/tagged/mlr3">
    <span class="fab fa fab fa-stack-overflow"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.com/">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Tuner using the Hyperband algorithm</h1>
    <small class="dont-index">Source: <a href='https://github.com/mlr-org/mlr3hyperband/blob/master/R/TunerHyperband.R'><code>R/TunerHyperband.R</code></a></small>
    <div class="hidden name"><code>mlr_tuners_hyperband.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>TunerHyperband</code> class that implements hyperband tuning. Hyperband is a
budget oriented-procedure, weeding out suboptimal performing configurations
early in a sequential training process, increasing tuning efficiency as a
consequence.</p>
<p>For this, several brackets are constructed with an associated set of
configurations for each bracket. Each bracket as several stages. Different
brackets are initialized with different amounts of configurations and
different budget sizes. To get an idea of how the bracket layout looks like
for a given argument set, please have a look in the <code>details</code>.</p>
<p>To identify the budget for evaluating hyperband, the user has to specify
explicitly which hyperparameter of the learner influences the budget by
tagging a single hyperparameter in the <a href='https://paradox.mlr-org.com/reference/ParamSet.html'>paradox::ParamSet</a> with <code>"budget"</code>.
An alternative approach using subsampling and pipelines is described below.</p>
<p>Naturally, hyperband terminates once all of its brackets are evaluated, so a
<a href='https://bbotk.mlr-org.com/reference/Terminator.html'>bbotk::Terminator</a> in the tuning instance acts as an upper bound and should
be only set to a low value if one is unsure of how long hyperband will take
to finish under the given settings.</p>
    </div>



    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This sections explains the calculation of the constants for each bracket.
A small overview will be given here, but for more details please check
out the original paper (see <code>references</code>).
To keep things uniform with the notation in the paper (and to safe space in
the formulas), <code>R</code> is used for the upper budget that last remaining
configuration should reach. The formula to calculate the amount of brackets
is <code>floor(log(R, eta)) + 1</code>. To calculate the starting budget in each
bracket, use <code>R * eta^(-s)</code>, where <code>s</code> is the maximum bracket minus the
current bracket index.
For the starting configurations in each bracket it is
<code><a href='https://rdrr.io/r/base/Round.html'>ceiling((B/R) * ((eta^s)/(s+1)))</a></code>, with <code>B = (bracket amount) * R</code>.
To receive a table with the full brackets layout, load the following function
and execute it for the desired <code>R</code> and <code>eta</code>.</p><pre><span class='kw'>hyperband_brackets</span> <span class='op'>=</span> <span class='fu'>function</span>(<span class='kw'>R</span>, <span class='kw'>eta</span>) {

  <span class='kw'>result</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>()
  <span class='kw'>smax</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>floor</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>(<span class='kw'>R</span>, <span class='kw'>eta</span>))
  <span class='kw'>B</span> <span class='op'>=</span> (<span class='kw'>smax</span> <span class='op'>+</span> <span class='fl'>1</span>) <span class='op'>*</span> <span class='kw'>R</span>

  <span class='co'># outer loop - iterate over brackets</span>
  <span class='co'>for</span> (<span class='kw'>s</span> <span class='co'>in</span> <span class='kw'>smax</span><span class='op'>:</span><span class='fl'>0</span>) {

    <span class='kw'>n</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>ceiling</a></span>((<span class='kw'>B</span><span class='op'>/</span><span class='kw'>R</span>) <span class='op'>*</span> ((<span class='kw'>eta</span><span class='op'>^</span><span class='kw'>s</span>)<span class='op'>/</span>(<span class='kw'>s</span><span class='op'>+</span><span class='fl'>1</span>)))
    <span class='kw'>r</span> <span class='op'>=</span> <span class='kw'>R</span> <span class='op'>*</span> <span class='kw'>eta</span><span class='op'>^</span>(<span class='op'>-</span><span class='kw'>s</span>)

    <span class='co'># inner loop - iterate over bracket stages</span>
    <span class='co'>for</span> (<span class='kw'>i</span> <span class='co'>in</span> <span class='fl'>0</span><span class='op'>:</span><span class='kw'>s</span>) {

      <span class='kw'>ni</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>floor</a></span>(<span class='kw'>n</span> <span class='op'>*</span> <span class='kw'>eta</span><span class='op'>^</span>(<span class='op'>-</span><span class='kw'>i</span>))
      <span class='kw'>ri</span> <span class='op'>=</span> <span class='kw'>r</span> <span class='op'>*</span> <span class='kw'>eta</span><span class='op'>^</span><span class='kw'>i</span>
      <span class='kw'>result</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span>(<span class='kw'>result</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='kw'>smax</span> <span class='op'>-</span> <span class='kw'>s</span> <span class='op'>+</span> <span class='fl'>1</span>, <span class='kw'>i</span> <span class='op'>+</span> <span class='fl'>1</span>, <span class='kw'>ri</span>, <span class='kw'>ni</span>))
    }
  }

  <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='kw'>result</span>) <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"bracket"</span>, <span class='st'>"bracket_stage"</span>, <span class='st'>"budget"</span>, <span class='st'>"n_configs"</span>)
  <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='kw'>result</span>)
}

<span class='fu'>hyperband_brackets</span>(R = <span class='fl'>81L</span>, eta = <span class='fl'>3L</span>)
</pre>

    <h2 class="hasAnchor" id="parameters"><a class="anchor" href="#parameters"></a>Parameters</h2>

    

<dl>
<dt><code>eta</code></dt><dd><p><code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code><br />
Fraction parameter of the successive halving algorithm: With every step the
configuration budget is increased by a factor of <code>eta</code> and only the best
<code>1/eta</code> configurations are used for the next stage. Non-integer values are
supported, but <code>eta</code> is not allowed to be less or equal 1.</p></dd>
<dt><code>sampler</code></dt><dd><p><a href='https://paradox.mlr-org.com/reference/Sampler.html'>paradox::Sampler</a><br />
Object defining how the samples of the parameter space should be drawn during
the initialization of each bracket. The default is uniform sampling.</p></dd>

</dl>

    <h2 class="hasAnchor" id="archive"><a class="anchor" href="#archive"></a>Archive</h2>

    

<p>The <a href='https://mlr3tuning.mlr-org.com/reference/ArchiveTuning.html'>mlr3tuning::ArchiveTuning</a> holds the following additional columns that
are specific to the hyperband tuner:</p><ul>
<li><p><code>bracket</code> (<code><a href='https://rdrr.io/r/base/integer.html'>integer(1)</a></code>)<br />
The console logs about the bracket index are actually not matching
with the original hyperband algorithm, which counts down the brackets
and stops after evaluating bracket 0. The true bracket indices are
given in this column.</p></li>
<li><p><code>bracket_stage</code> (<code>integer(1))</code><br />
The bracket stage of each bracket. Hyperband starts counting at 0.</p></li>
<li><p><code>budget_scaled</code> (<code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code>)<br />
The intermediate budget in each bracket stage calculated by hyperband.
Because hyperband is originally only considered for budgets starting at 1, some
rescaling is done to allow budgets starting at different values.
For this, budgets are internally divided by the lower budget bound to
get a lower budget of 1. Before the learner
receives its budgets for evaluation, the budget is transformed back to
match the original scale again.</p></li>
<li><p><code>budget_real</code> (<code><a href='https://rdrr.io/r/base/numeric.html'>numeric(1)</a></code>)<br />
The real budget values the learner uses for evaluation after hyperband
calculated its scaled budget.</p></li>
<li><p><code>n_configs</code> (<code><a href='https://rdrr.io/r/base/integer.html'>integer(1)</a></code>)<br />
The amount of evaluated configurations in each stage. These correspond
to the <code>r_i</code> in the original paper.</p></li>
</ul>

    <h2 class="hasAnchor" id="hyperband-without-learner-budget"><a class="anchor" href="#hyperband-without-learner-budget"></a>Hyperband without learner budget</h2>

    

<p>Thanks to <a href='https://CRAN.R-project.org/package=mlr3pipelines'><span class="pkg">mlr3pipelines</span></a>, it is possible to use hyperband in
combination with learners lacking a natural budget parameter. For example,
any <a href='https://mlr3.mlr-org.com/reference/Learner.html'>mlr3::Learner</a> can be augmented with a <a href='https://mlr3pipelines.mlr-org.com//reference/PipeOp.html'>mlr3pipelines::PipeOp</a>
operator such as <a href='https://mlr3pipelines.mlr-org.com//reference/mlr_pipeops_subsample.html'>mlr3pipelines::PipeOpSubsample</a>. With the
subsampling rate as budget parameter, the resulting
<a href='https://mlr3pipelines.mlr-org.com//reference/mlr_learners_graph.html'>mlr3pipelines::GraphLearner</a> is fitted on small proportions of
the <a href='https://mlr3.mlr-org.com/reference/Task.html'>mlr3::Task</a> in the first brackets, and on the complete Task in
last brackets. See examples for some code.</p>
    <h2 class="hasAnchor" id="custom-sampler"><a class="anchor" href="#custom-sampler"></a>Custom sampler</h2>

    

<p>Hyperband supports custom <a href='https://paradox.mlr-org.com/reference/Sampler.html'>paradox::Sampler</a> object for initial
configurations in each bracket.
A custom sampler may look like this (the full example is given in the
<code>examples</code> section):</p><pre><span class='co'># - beta distribution with alpha = 2 and beta = 5</span>
<span class='co'># - categorical distribution with custom probabilities</span>
<span class='kw'>sampler</span> <span class='op'>=</span> <span class='kw'>SamplerJointIndep</span><span class='op'>$</span><span class='fu'>new</span>(<span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
  <span class='kw'>Sampler1DRfun</span><span class='op'>$</span><span class='fu'>new</span>(<span class='kw'>params</span>[[<span class='fl'>2</span>]], <span class='fu'>function</span>(<span class='kw'>n</span>) <span class='fu'><a href='https://rdrr.io/r/stats/Beta.html'>rbeta</a></span>(<span class='kw'>n</span>, <span class='fl'>2</span>, <span class='fl'>5</span>)),
  <span class='kw'>Sampler1DCateg</span><span class='op'>$</span><span class='fu'>new</span>(<span class='kw'>params</span>[[<span class='fl'>3</span>]], prob = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.2</span>, <span class='fl'>0.3</span>, <span class='fl'>0.5</span>))
))
</pre>

    <h2 class="hasAnchor" id="runtime-scaling-w-r-t-the-chosen-budget"><a class="anchor" href="#runtime-scaling-w-r-t-the-chosen-budget"></a>Runtime scaling w.r.t. the chosen budget</h2>

    

<p>The calculation of each bracket currently assumes a linear runtime in the
chosen budget parameter is always given. Hyperband is designed so each
bracket requires approximately the same runtime as the sum of the budget
over all configurations in each bracket is roughly the same. This will not
hold true once the scaling in the budget parameter is not linear
anymore, even though the sum of the budgets in each bracket remains the
same. A basic example can be viewed by calling the function
<code>hyperband_brackets</code> below with the arguments <code>R = 2</code> and <code>eta = 2</code>. If we
run a learner with O(budget^2) time complexity, the runtime of the last
bracket will be 33% longer than the first bracket
(time of bracket 1 = 2 * 1^2 + 2^2 = 6; time of bracket 2 = 2 * 2^2 = 8).
Of course, this won't break anything, but it should be kept in mind when
applying hyperband. A possible adaption would be to introduce a trafo,
like it is shown in the <code>examples</code>.</p>
    <h2 class="hasAnchor" id="logging"><a class="anchor" href="#logging"></a>Logging</h2>

    

<p>When loading the <a href='mlr3hyperband-package.html'>mlr3hyperband</a> package, two loggers based on the lgr
package are made available. One is called <code>mlr3</code>, the other <code>bbotk</code>. All
<code>mlr3</code> methods log into the <code>mlr3</code> logger. All optimization methods form the
packags bbotk, <a href='https://mlr3tuning.mlr-org.com/reference/mlr3tuning-package.html'>mlr3tuning</a> and <a href='mlr3hyperband-package.html'>mlr3hyperband</a> log into the <code>bbotk</code>
logger. To hide the <a href='https://mlr3.mlr-org.com/reference/mlr3-package.html'>mlr3</a> logging messages run:</p><pre><span class='kw'>lgr</span>::<span class='fu'><a href='https://rdrr.io/pkg/lgr/man/get_logger.html'>get_logger</a></span>(<span class='st'>"mlr3"</span>)<span class='op'>$</span><span class='fu'>set_threshold</span>(<span class='st'>"warn"</span>)
</pre>

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Li L, Jamieson K, DeSalvo G, Rostamizadeh A, Talwalkar A (2018).
&#8220;Hyperband: A Novel Bandit-Based Approach to Hyperparameter Optimization.&#8221;
<em>Journal of Machine Learning Research</em>, <b>18</b>(185), 1-52.
<a href='http://jmlr.org/papers/v18/16-558.html'>http://jmlr.org/papers/v18/16-558.html</a>.</p>
    <h2 class="hasAnchor" id="super-class"><a class="anchor" href="#super-class"></a>Super class</h2>

    <p><code><a href='https://mlr3tuning.mlr-org.com/reference/Tuner.html'>mlr3tuning::Tuner</a></code> -&gt; <code>TunerHyperband</code></p>
    <h2 class="hasAnchor" id="methods"><a class="anchor" href="#methods"></a>Methods</h2>

    
<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Public methods</h3>

<ul>
<li><p><a href='#method-new'><code>TunerHyperband$new()</code></a></p></li>
<li><p><a href='#method-clone'><code>TunerHyperband$clone()</code></a></p></li>
</ul>
<p><details open ><summary>Inherited methods</summary>
<ul>
<li><p><span class="pkg-link" data-pkg="mlr3tuning" data-topic="Tuner" data-id="format"><a href='../../mlr3tuning/html/Tuner.html#method-format'><code>mlr3tuning::Tuner$format()</code></a></span></p></li>
<li><p><span class="pkg-link" data-pkg="mlr3tuning" data-topic="Tuner" data-id="optimize"><a href='../../mlr3tuning/html/Tuner.html#method-optimize'><code>mlr3tuning::Tuner$optimize()</code></a></span></p></li>
<li><p><span class="pkg-link" data-pkg="mlr3tuning" data-topic="Tuner" data-id="print"><a href='../../mlr3tuning/html/Tuner.html#method-print'><code>mlr3tuning::Tuner$print()</code></a></span></p></li>
</ul>
</details>

<hr>
<a id="method-new"></a></p><h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Method <code>new()</code></h3>
<p>Creates a new instance of this <a href='https://rdrr.io/pkg/R6/man/R6Class.html'>R6</a> class.</p><h4 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Usage</h4>
<p><div class="r"></p><pre><span class='kw'>TunerHyperband</span><span class='op'>$</span><span class='fu'>new</span>()</pre><p></div></p>

<p><hr>
<a id="method-clone"></a></p><h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Method <code>clone()</code></h3>
<p>The objects of this class are cloneable with this method.</p><h4 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Usage</h4>
<p><div class="r"></p><pre><span class='kw'>TunerHyperband</span><span class='op'>$</span><span class='fu'>clone</span>(deep = <span class='fl'>FALSE</span>)</pre><p></div></p>

<h4 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Arguments</h4>
<p><div class="arguments"></p><dl>
<dt><code>deep</code></dt><dd><p>Whether to make a deep clone.</p></dd>

</dl><p></div></p>



    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='kw'><a href='https://mlr3hyperband.mlr-org.com'>mlr3hyperband</a></span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='kw'><a href='https://mlr3learners.mlr-org.com'>mlr3learners</a></span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='kw'><a href='https://mlr3tuning.mlr-org.com'>mlr3tuning</a></span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='kw'><a href='https://mlr3.mlr-org.com'>mlr3</a></span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='kw'><a href='https://paradox.mlr-org.com'>paradox</a></span>)

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>123</span>)

<span class='co'># define hyperparameter and budget parameter for tuning with hyperband</span>
<span class='kw'>params</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
  <span class='kw'>ParamInt</span><span class='op'>$</span><span class='fu'>new</span>(<span class='st'>"nrounds"</span>, lower = <span class='fl'>1</span>, upper = <span class='fl'>16</span>, tag = <span class='st'>"budget"</span>),
  <span class='kw'>ParamDbl</span><span class='op'>$</span><span class='fu'>new</span>(<span class='st'>"eta"</span>, lower = <span class='fl'>0</span>, upper = <span class='fl'>1</span>),
  <span class='kw'>ParamFct</span><span class='op'>$</span><span class='fu'>new</span>(<span class='st'>"booster"</span>, levels = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"gbtree"</span>, <span class='st'>"gblinear"</span>, <span class='st'>"dart"</span>))
)


<span class='kw'>inst</span> <span class='op'>=</span> <span class='kw'>TuningInstanceSingleCrit</span><span class='op'>$</span><span class='fu'>new</span>(
  <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>tsk</a></span>(<span class='st'>"iris"</span>),
  <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>lrn</a></span>(<span class='st'>"classif.xgboost"</span>),
  <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>rsmp</a></span>(<span class='st'>"holdout"</span>),
  <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>msr</a></span>(<span class='st'>"classif.ce"</span>),
  <span class='kw'>ParamSet</span><span class='op'>$</span><span class='fu'>new</span>(<span class='kw'>params</span>),
  <span class='fu'><a href='https://mlr3tuning.mlr-org.com/reference/trm.html'>trm</a></span>(<span class='st'>"evals"</span>, n_evals = <span class='fl'>100000</span>)
)

<span class='co'># create custom sampler (optional):</span>
<span class='co'># - beta distribution with alpha = 2 and beta = 5</span>
<span class='co'># - categorical distribution with custom probabilities</span>
<span class='kw'>sampler</span> <span class='op'>=</span> <span class='kw'>SamplerJointIndep</span><span class='op'>$</span><span class='fu'>new</span>(<span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
  <span class='kw'>Sampler1DRfun</span><span class='op'>$</span><span class='fu'>new</span>(<span class='kw'>params</span>[[<span class='fl'>2</span>]], <span class='fu'>function</span>(<span class='kw'>n</span>) <span class='fu'><a href='https://rdrr.io/r/stats/Beta.html'>rbeta</a></span>(<span class='kw'>n</span>, <span class='fl'>2</span>, <span class='fl'>5</span>)),
  <span class='kw'>Sampler1DCateg</span><span class='op'>$</span><span class='fu'>new</span>(<span class='kw'>params</span>[[<span class='fl'>3</span>]], prob = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.2</span>, <span class='fl'>0.3</span>, <span class='fl'>0.5</span>))
))

<span class='kw'>tuner</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3tuning.mlr-org.com/reference/tnr.html'>tnr</a></span>(<span class='st'>"hyperband"</span>, eta = <span class='fl'>2L</span>, sampler = <span class='kw'>sampler</span>)
<span class='co'># \donttest{</span>
<span class='kw'>tuner</span><span class='op'>$</span><span class='fu'><a href='https://rdrr.io/r/stats/optimize.html'>optimize</a></span>(<span class='kw'>inst</span>)
</div><div class='output co'>#&gt;    nrounds      eta booster learner_param_vals  x_domain classif.ce
#&gt; 1:       1 0.231625    dart          &lt;list[4]&gt; &lt;list[3]&gt;       0.04</div><div class='input'>
<span class='co'># return the best evaluation</span>
<span class='kw'>inst</span><span class='op'>$</span><span class='kw'>result</span>
</div><div class='output co'>#&gt;    nrounds      eta booster learner_param_vals  x_domain classif.ce
#&gt; 1:       1 0.231625    dart          &lt;list[4]&gt; &lt;list[3]&gt;       0.04</div><div class='input'>
<span class='co'># print all evaluations</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='kw'>inst</span><span class='op'>$</span><span class='kw'>archive</span><span class='op'>$</span><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>())
</div><div class='output co'>#&gt;            eta  booster nrounds bracket bracket_stage budget_scaled budget_real
#&gt;  1: 0.16633231 gblinear       1       4             0             1           1
#&gt;  2: 0.53672392 gblinear       1       4             0             1           1
#&gt;  3: 0.23162500     dart       1       4             0             1           1
#&gt;  4: 0.09921319     dart       1       4             0             1           1
#&gt;  5: 0.32374930     dart       1       4             0             1           1
#&gt;  6: 0.25848344 gblinear       1       4             0             1           1
#&gt;  7: 0.28687990 gblinear       1       4             0             1           1
#&gt;  8: 0.36995279   gbtree       1       4             0             1           1
#&gt;  9: 0.21663062 gblinear       1       4             0             1           1
#&gt; 10: 0.43375908     dart       1       4             0             1           1
#&gt; 11: 0.24324338 gblinear       1       4             0             1           1
#&gt; 12: 0.35748527     dart       1       4             0             1           1
#&gt; 13: 0.38180400     dart       1       4             0             1           1
#&gt; 14: 0.22436454     dart       1       4             0             1           1
#&gt; 15: 0.57168085     dart       1       4             0             1           1
#&gt; 16: 0.52772844   gbtree       1       4             0             1           1
#&gt; 17: 0.23162500     dart       2       4             1             2           2
#&gt; 18: 0.09921319     dart       2       4             1             2           2
#&gt; 19: 0.32374930     dart       2       4             1             2           2
#&gt; 20: 0.36995279   gbtree       2       4             1             2           2
#&gt; 21: 0.43375908     dart       2       4             1             2           2
#&gt; 22: 0.35748527     dart       2       4             1             2           2
#&gt; 23: 0.38180400     dart       2       4             1             2           2
#&gt; 24: 0.22436454     dart       2       4             1             2           2
#&gt; 25: 0.23162500     dart       4       4             2             4           4
#&gt; 26: 0.09921319     dart       4       4             2             4           4
#&gt; 27: 0.32374930     dart       4       4             2             4           4
#&gt; 28: 0.36995279   gbtree       4       4             2             4           4
#&gt; 29: 0.23162500     dart       8       4             3             8           8
#&gt; 30: 0.09921319     dart       8       4             3             8           8
#&gt; 31: 0.23162500     dart      16       4             4            16          16
#&gt; 32: 0.12152038     dart       2       3             0             2           2
#&gt; 33: 0.31007089     dart       2       3             0             2           2
#&gt; 34: 0.13099165     dart       2       3             0             2           2
#&gt; 35: 0.19669320     dart       2       3             0             2           2
#&gt; 36: 0.23676637     dart       2       3             0             2           2
#&gt; 37: 0.17165036 gblinear       2       3             0             2           2
#&gt; 38: 0.33564743     dart       2       3             0             2           2
#&gt; 39: 0.30172118     dart       2       3             0             2           2
#&gt; 40: 0.12918127     dart       2       3             0             2           2
#&gt; 41: 0.27152929   gbtree       2       3             0             2           2
#&gt; 42: 0.12152038     dart       4       3             1             4           4
#&gt; 43: 0.31007089     dart       4       3             1             4           4
#&gt; 44: 0.13099165     dart       4       3             1             4           4
#&gt; 45: 0.19669320     dart       4       3             1             4           4
#&gt; 46: 0.23676637     dart       4       3             1             4           4
#&gt; 47: 0.12152038     dart       8       3             2             8           8
#&gt; 48: 0.31007089     dart       8       3             2             8           8
#&gt; 49: 0.12152038     dart      16       3             3            16          16
#&gt; 50: 0.44501551     dart       4       2             0             4           4
#&gt; 51: 0.09232408     dart       4       2             0             4           4
#&gt; 52: 0.47135712   gbtree       4       2             0             4           4
#&gt; 53: 0.46636871     dart       4       2             0             4           4
#&gt; 54: 0.35758233     dart       4       2             0             4           4
#&gt; 55: 0.12343101   gbtree       4       2             0             4           4
#&gt; 56: 0.26219631 gblinear       4       2             0             4           4
#&gt; 57: 0.44501551     dart       8       2             1             8           8
#&gt; 58: 0.09232408     dart       8       2             1             8           8
#&gt; 59: 0.47135712   gbtree       8       2             1             8           8
#&gt; 60: 0.44501551     dart      16       2             2            16          16
#&gt; 61: 0.18500249   gbtree       8       1             0             8           8
#&gt; 62: 0.52125349 gblinear       8       1             0             8           8
#&gt; 63: 0.28196564     dart       8       1             0             8           8
#&gt; 64: 0.36458346     dart       8       1             0             8           8
#&gt; 65: 0.10382335   gbtree       8       1             0             8           8
#&gt; 66: 0.18500249   gbtree      16       1             1            16          16
#&gt; 67: 0.28196564     dart      16       1             1            16          16
#&gt; 68: 0.11684580 gblinear      16       0             0            16          16
#&gt; 69: 0.60449159 gblinear      16       0             0            16          16
#&gt; 70: 0.22024316     dart      16       0             0            16          16
#&gt; 71: 0.14160471 gblinear      16       0             0            16          16
#&gt; 72: 0.24035756 gblinear      16       0             0            16          16
#&gt;            eta  booster nrounds bracket bracket_stage budget_scaled budget_real
#&gt;     n_configs classif.ce                                uhash  x_domain
#&gt;  1:        16       0.74 5f07d0d5-e798-4ad1-a770-0822235ded34 &lt;list[3]&gt;
#&gt;  2:        16       0.54 57d00b95-30ad-4feb-acd7-62aa2bbdd855 &lt;list[3]&gt;
#&gt;  3:        16       0.04 2408d3f6-9930-4c8c-9641-a2af880ae3b0 &lt;list[3]&gt;
#&gt;  4:        16       0.04 39cc4628-22cc-4251-b894-6fa74eab781f &lt;list[3]&gt;
#&gt;  5:        16       0.04 974843fa-f9a7-4b10-ac5a-0e9349dfc4e6 &lt;list[3]&gt;
#&gt;  6:        16       0.70 ffbf49bf-a0b3-45c9-a204-0ff7770b99d8 &lt;list[3]&gt;
#&gt;  7:        16       0.74 fa7b949f-2ed6-4a11-8972-27c8752944e0 &lt;list[3]&gt;
#&gt;  8:        16       0.04 01719dd0-4394-4cc3-819d-51c2f343458d &lt;list[3]&gt;
#&gt;  9:        16       0.74 8a6b5493-c025-4beb-b810-e406dfd3b101 &lt;list[3]&gt;
#&gt; 10:        16       0.04 14b3012c-6207-4352-af1d-b32c9a528383 &lt;list[3]&gt;
#&gt; 11:        16       0.70 a6a65f51-45d5-4ad4-82bb-b8ce5971e53f &lt;list[3]&gt;
#&gt; 12:        16       0.04 ad5d8846-26b0-44dd-814a-7b2e8cca795c &lt;list[3]&gt;
#&gt; 13:        16       0.04 3a53253e-f77b-41e6-9a4b-efcf3d213166 &lt;list[3]&gt;
#&gt; 14:        16       0.04 2adc7c1b-98e3-460b-9405-089166d17d3a &lt;list[3]&gt;
#&gt; 15:        16       0.04 46efce2a-62e8-4204-98ee-5ef57ddd4e7b &lt;list[3]&gt;
#&gt; 16:        16       0.04 396325c5-b556-4d01-ab1c-f152805d2b6f &lt;list[3]&gt;
#&gt; 17:         8       0.04 749510a5-ab0e-422b-9ca9-604b4a3b0261 &lt;list[3]&gt;
#&gt; 18:         8       0.04 b9d54985-fdcf-4c19-b52e-cf547224d44f &lt;list[3]&gt;
#&gt; 19:         8       0.04 2d51041e-1827-46aa-a7d7-b08fd6787bad &lt;list[3]&gt;
#&gt; 20:         8       0.04 3637baa2-9e3d-4db1-b402-fb790ebf4bbd &lt;list[3]&gt;
#&gt; 21:         8       0.04 3480dd92-87a7-498c-a2f6-99815f548b48 &lt;list[3]&gt;
#&gt; 22:         8       0.04 634b1761-031e-4a79-8f14-461d7a678fde &lt;list[3]&gt;
#&gt; 23:         8       0.04 1c6ef453-d18f-4637-9304-554a165cdc24 &lt;list[3]&gt;
#&gt; 24:         8       0.04 73b7f993-d380-4c93-a1cb-c641fe1c4306 &lt;list[3]&gt;
#&gt; 25:         4       0.04 7dd36877-7eee-4091-b70c-503c627fd152 &lt;list[3]&gt;
#&gt; 26:         4       0.04 8ba48f0a-f89e-44f3-a109-a127a7140e10 &lt;list[3]&gt;
#&gt; 27:         4       0.04 76b21a67-fc52-4806-a706-9f25f171044a &lt;list[3]&gt;
#&gt; 28:         4       0.04 05a3bb83-a0f8-4dde-bf13-239ea4743f8d &lt;list[3]&gt;
#&gt; 29:         2       0.04 0c1c3ef5-eb34-4da8-b715-920c6b6230fb &lt;list[3]&gt;
#&gt; 30:         2       0.04 f339cd83-f030-4b1d-84a4-e94bc9904273 &lt;list[3]&gt;
#&gt; 31:         1       0.04 078641c8-8f41-436b-aa06-701543f7db03 &lt;list[3]&gt;
#&gt; 32:        10       0.04 7570242c-1eb2-4b0a-bb2e-71c4d0bc4b23 &lt;list[3]&gt;
#&gt; 33:        10       0.04 9f154a9c-3d19-4271-9ef6-8dc515241af9 &lt;list[3]&gt;
#&gt; 34:        10       0.04 19549d05-4c0d-41e6-8355-b7af3b28af74 &lt;list[3]&gt;
#&gt; 35:        10       0.04 2202dc48-3f6d-4b3d-a629-96d80bfe2d96 &lt;list[3]&gt;
#&gt; 36:        10       0.04 c5cafd0c-5ad1-4c81-817d-78424f8ffc53 &lt;list[3]&gt;
#&gt; 37:        10       0.74 0b359adc-1bfe-4f8f-a211-9abf1c4c827c &lt;list[3]&gt;
#&gt; 38:        10       0.04 2a50aa30-157f-4734-af37-2d6df9f18a4f &lt;list[3]&gt;
#&gt; 39:        10       0.04 253d7e66-85bc-4eb3-9346-bad99a6925ac &lt;list[3]&gt;
#&gt; 40:        10       0.04 7bf7b4ea-37ab-4b8e-896a-9678767f5d85 &lt;list[3]&gt;
#&gt; 41:        10       0.04 1fcaa9f3-ae24-40ca-a4ee-bbb7e191bf39 &lt;list[3]&gt;
#&gt; 42:         5       0.04 f4f8aa3e-4d0a-488f-b582-3e9fa7c2fa28 &lt;list[3]&gt;
#&gt; 43:         5       0.04 6b1f84bb-4f3f-498b-b6a7-f75b1d16d3b5 &lt;list[3]&gt;
#&gt; 44:         5       0.04 49a051d0-631f-4bd7-ba16-03c72d30214b &lt;list[3]&gt;
#&gt; 45:         5       0.04 70b0242d-d1fe-4c67-856f-8bcdb49d9acb &lt;list[3]&gt;
#&gt; 46:         5       0.04 e25e9794-74d4-431f-a54c-42fe4279a430 &lt;list[3]&gt;
#&gt; 47:         2       0.04 8bed605c-a9aa-4cc9-80b7-3aefaf514f76 &lt;list[3]&gt;
#&gt; 48:         2       0.04 f365755c-1e61-4b15-8359-abc0bb974976 &lt;list[3]&gt;
#&gt; 49:         1       0.04 8d2dd1d5-7459-4aad-a003-0788079b72ae &lt;list[3]&gt;
#&gt; 50:         7       0.04 2f3d27e2-6d90-4bc1-bac8-6c7e81f71684 &lt;list[3]&gt;
#&gt; 51:         7       0.04 8ba1caf4-b02b-40d2-87b5-8189cecdf78e &lt;list[3]&gt;
#&gt; 52:         7       0.04 bb5d9a2f-7bce-4e25-93ee-2cb991ea35a4 &lt;list[3]&gt;
#&gt; 53:         7       0.04 76489366-9ea0-4c20-a634-4628aed6513e &lt;list[3]&gt;
#&gt; 54:         7       0.04 ec194883-6f65-43d3-ae55-48e2d58a9109 &lt;list[3]&gt;
#&gt; 55:         7       0.04 f48a4114-9eac-49d3-a657-5307c486e563 &lt;list[3]&gt;
#&gt; 56:         7       0.42 6e770e81-adc9-4b53-aae7-0e9f9736cbc9 &lt;list[3]&gt;
#&gt; 57:         3       0.04 307a61eb-402e-414c-990c-c495fc081dd7 &lt;list[3]&gt;
#&gt; 58:         3       0.04 ded6fe99-eff1-4304-8529-76941a4d75ce &lt;list[3]&gt;
#&gt; 59:         3       0.04 0993986d-6170-4cad-9efd-9937215cb5fe &lt;list[3]&gt;
#&gt; 60:         1       0.04 8be12ac7-a1d2-4644-8e9d-cf693194adf1 &lt;list[3]&gt;
#&gt; 61:         5       0.04 6e5edbce-e053-4d0a-916c-87609cb2c754 &lt;list[3]&gt;
#&gt; 62:         5       0.42 45080669-a957-46aa-95a8-927d6a9767d0 &lt;list[3]&gt;
#&gt; 63:         5       0.04 1924a778-4b56-487b-b3c1-b8d69a8cdfad &lt;list[3]&gt;
#&gt; 64:         5       0.04 76bad1ff-19c4-4f9f-bd9e-938ac54deb9d &lt;list[3]&gt;
#&gt; 65:         5       0.04 80da0da8-ce40-426b-b3ea-cfe109c963ab &lt;list[3]&gt;
#&gt; 66:         2       0.04 8e0de795-2881-4adb-930a-3f5970e27389 &lt;list[3]&gt;
#&gt; 67:         2       0.04 ec74357b-eec4-4631-8629-8a85ecf8b3f6 &lt;list[3]&gt;
#&gt; 68:         5       0.42 310ff22a-0369-4993-8031-5606fd93083d &lt;list[3]&gt;
#&gt; 69:         5       0.18 46572617-fbba-49fa-891c-5f01b6ee4aba &lt;list[3]&gt;
#&gt; 70:         5       0.04 86ac1bd5-3ce0-43b2-9c28-a97572b718e7 &lt;list[3]&gt;
#&gt; 71:         5       0.42 dd3ab460-106e-4dd4-a476-2d36293eb8d3 &lt;list[3]&gt;
#&gt; 72:         5       0.42 37e2bd6f-0615-4c0b-8a5f-1afc8aa4d0ce &lt;list[3]&gt;
#&gt;     n_configs classif.ce                                uhash  x_domain
#&gt;               timestamp batch_nr
#&gt;  1: 2020-09-10 07:46:27        1
#&gt;  2: 2020-09-10 07:46:27        1
#&gt;  3: 2020-09-10 07:46:27        1
#&gt;  4: 2020-09-10 07:46:27        1
#&gt;  5: 2020-09-10 07:46:27        1
#&gt;  6: 2020-09-10 07:46:27        1
#&gt;  7: 2020-09-10 07:46:27        1
#&gt;  8: 2020-09-10 07:46:27        1
#&gt;  9: 2020-09-10 07:46:27        1
#&gt; 10: 2020-09-10 07:46:27        1
#&gt; 11: 2020-09-10 07:46:27        1
#&gt; 12: 2020-09-10 07:46:27        1
#&gt; 13: 2020-09-10 07:46:27        1
#&gt; 14: 2020-09-10 07:46:27        1
#&gt; 15: 2020-09-10 07:46:27        1
#&gt; 16: 2020-09-10 07:46:27        1
#&gt; 17: 2020-09-10 07:46:28        2
#&gt; 18: 2020-09-10 07:46:28        2
#&gt; 19: 2020-09-10 07:46:28        2
#&gt; 20: 2020-09-10 07:46:28        2
#&gt; 21: 2020-09-10 07:46:28        2
#&gt; 22: 2020-09-10 07:46:28        2
#&gt; 23: 2020-09-10 07:46:28        2
#&gt; 24: 2020-09-10 07:46:28        2
#&gt; 25: 2020-09-10 07:46:28        3
#&gt; 26: 2020-09-10 07:46:28        3
#&gt; 27: 2020-09-10 07:46:28        3
#&gt; 28: 2020-09-10 07:46:28        3
#&gt; 29: 2020-09-10 07:46:28        4
#&gt; 30: 2020-09-10 07:46:28        4
#&gt; 31: 2020-09-10 07:46:28        5
#&gt; 32: 2020-09-10 07:46:29        6
#&gt; 33: 2020-09-10 07:46:29        6
#&gt; 34: 2020-09-10 07:46:29        6
#&gt; 35: 2020-09-10 07:46:29        6
#&gt; 36: 2020-09-10 07:46:29        6
#&gt; 37: 2020-09-10 07:46:29        6
#&gt; 38: 2020-09-10 07:46:29        6
#&gt; 39: 2020-09-10 07:46:29        6
#&gt; 40: 2020-09-10 07:46:29        6
#&gt; 41: 2020-09-10 07:46:29        6
#&gt; 42: 2020-09-10 07:46:30        7
#&gt; 43: 2020-09-10 07:46:30        7
#&gt; 44: 2020-09-10 07:46:30        7
#&gt; 45: 2020-09-10 07:46:30        7
#&gt; 46: 2020-09-10 07:46:30        7
#&gt; 47: 2020-09-10 07:46:30        8
#&gt; 48: 2020-09-10 07:46:30        8
#&gt; 49: 2020-09-10 07:46:30        9
#&gt; 50: 2020-09-10 07:46:30       10
#&gt; 51: 2020-09-10 07:46:30       10
#&gt; 52: 2020-09-10 07:46:30       10
#&gt; 53: 2020-09-10 07:46:30       10
#&gt; 54: 2020-09-10 07:46:30       10
#&gt; 55: 2020-09-10 07:46:30       10
#&gt; 56: 2020-09-10 07:46:30       10
#&gt; 57: 2020-09-10 07:46:31       11
#&gt; 58: 2020-09-10 07:46:31       11
#&gt; 59: 2020-09-10 07:46:31       11
#&gt; 60: 2020-09-10 07:46:31       12
#&gt; 61: 2020-09-10 07:46:31       13
#&gt; 62: 2020-09-10 07:46:31       13
#&gt; 63: 2020-09-10 07:46:31       13
#&gt; 64: 2020-09-10 07:46:31       13
#&gt; 65: 2020-09-10 07:46:31       13
#&gt; 66: 2020-09-10 07:46:32       14
#&gt; 67: 2020-09-10 07:46:32       14
#&gt; 68: 2020-09-10 07:46:32       15
#&gt; 69: 2020-09-10 07:46:32       15
#&gt; 70: 2020-09-10 07:46:32       15
#&gt; 71: 2020-09-10 07:46:32       15
#&gt; 72: 2020-09-10 07:46:32       15
#&gt;               timestamp batch_nr</div><div class='input'><span class='co'># }</span>


<span class='co'>### use parameter trafo to convert budget parameter</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>123</span>)

<span class='co'># define hyperparameter and budget parameter for tuning with hyperband</span>
<span class='kw'>ps</span> <span class='op'>=</span> <span class='kw'>ParamSet</span><span class='op'>$</span><span class='fu'>new</span>(<span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
  <span class='kw'>ParamInt</span><span class='op'>$</span><span class='fu'>new</span>(<span class='st'>"nrounds"</span>, lower = <span class='fl'>1</span>, upper = <span class='fl'>10</span>, tags = <span class='st'>"budget"</span>),
  <span class='co'># ParamDbl$new("eta",     lower = 0, upper = 1),</span>
  <span class='kw'>ParamFct</span><span class='op'>$</span><span class='fu'>new</span>(<span class='st'>"booster"</span>, levels = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"gbtree"</span>, <span class='st'>"gblinear"</span>, <span class='st'>"dart"</span>))
))

<span class='kw'>ps</span><span class='op'>$</span><span class='kw'>trafo</span> <span class='op'>=</span> <span class='fu'>function</span>(<span class='kw'>x</span>, <span class='kw'>param_set</span>) {
  <span class='kw'>x</span><span class='op'>$</span><span class='kw'>nrounds</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>(<span class='kw'>x</span><span class='op'>$</span><span class='kw'>nrounds</span>)) <span class='op'>+</span> <span class='fl'>1L</span>
  <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='kw'>x</span>)
}

<span class='kw'>inst</span> <span class='op'>=</span> <span class='kw'>TuningInstanceSingleCrit</span><span class='op'>$</span><span class='fu'>new</span>(
  <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>tsk</a></span>(<span class='st'>"iris"</span>),
  <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>lrn</a></span>(<span class='st'>"classif.xgboost"</span>),
  <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>rsmp</a></span>(<span class='st'>"holdout"</span>),
  <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>msr</a></span>(<span class='st'>"classif.ce"</span>),
  <span class='kw'>ps</span>,
  <span class='fu'><a href='https://mlr3tuning.mlr-org.com/reference/trm.html'>trm</a></span>(<span class='st'>"evals"</span>, n_evals = <span class='fl'>100000</span>)
)

<span class='co'># eta can be a double</span>
<span class='kw'>tuner</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3tuning.mlr-org.com/reference/tnr.html'>tnr</a></span>(<span class='st'>"hyperband"</span>, eta = <span class='fl'>1.9</span>)
<span class='co'># \donttest{</span>
<span class='kw'>tuner</span><span class='op'>$</span><span class='fu'><a href='https://rdrr.io/r/stats/optimize.html'>optimize</a></span>(<span class='kw'>inst</span>)
</div><div class='output co'>#&gt;    nrounds booster learner_param_vals  x_domain classif.ce
#&gt; 1:       1  gbtree          &lt;list[3]&gt; &lt;list[2]&gt;       0.04</div><div class='input'>
<span class='co'># return the best evaluation</span>
<span class='kw'>inst</span><span class='op'>$</span><span class='kw'>result</span>
</div><div class='output co'>#&gt;    nrounds booster learner_param_vals  x_domain classif.ce
#&gt; 1:       1  gbtree          &lt;list[3]&gt; &lt;list[2]&gt;       0.04</div><div class='input'>
<span class='co'># print all evaluations</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='kw'>inst</span><span class='op'>$</span><span class='kw'>archive</span><span class='op'>$</span><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>())
</div><div class='output co'>#&gt;      booster nrounds bracket bracket_stage budget_scaled budget_real n_configs
#&gt;  1:   gbtree       1       3             0      1.457938           1         7
#&gt;  2:     dart       1       3             0      1.457938           1         7
#&gt;  3:     dart       1       3             0      1.457938           1         7
#&gt;  4: gblinear       1       3             0      1.457938           1         7
#&gt;  5: gblinear       1       3             0      1.457938           1         7
#&gt;  6:   gbtree       1       3             0      1.457938           1         7
#&gt;  7:   gbtree       1       3             0      1.457938           1         7
#&gt;  8:   gbtree       3       3             1      2.770083           3         3
#&gt;  9:     dart       3       3             1      2.770083           3         3
#&gt; 10:     dart       3       3             1      2.770083           3         3
#&gt; 11:   gbtree       5       3             2      5.263158           5         1
#&gt; 12:   gbtree      10       3             3     10.000000          10         1
#&gt; 13: gblinear       3       2             0      2.770083           3         5
#&gt; 14: gblinear       3       2             0      2.770083           3         5
#&gt; 15:   gbtree       3       2             0      2.770083           3         5
#&gt; 16: gblinear       3       2             0      2.770083           3         5
#&gt; 17:   gbtree       3       2             0      2.770083           3         5
#&gt; 18:   gbtree       5       2             1      5.263158           5         2
#&gt; 19:   gbtree       5       2             1      5.263158           5         2
#&gt; 20:   gbtree      10       2             2     10.000000          10         1
#&gt; 21: gblinear       5       1             0      5.263158           5         4
#&gt; 22: gblinear       5       1             0      5.263158           5         4
#&gt; 23: gblinear       5       1             0      5.263158           5         4
#&gt; 24: gblinear       5       1             0      5.263158           5         4
#&gt; 25: gblinear      10       1             1     10.000000          10         2
#&gt; 26: gblinear      10       1             1     10.000000          10         2
#&gt; 27: gblinear      10       0             0     10.000000          10         4
#&gt; 28: gblinear      10       0             0     10.000000          10         4
#&gt; 29:     dart      10       0             0     10.000000          10         4
#&gt; 30:   gbtree      10       0             0     10.000000          10         4
#&gt;      booster nrounds bracket bracket_stage budget_scaled budget_real n_configs
#&gt;     classif.ce                                uhash  x_domain
#&gt;  1:       0.04 beef8351-99a6-47d8-bb84-4b7c6a1cb597 &lt;list[2]&gt;
#&gt;  2:       0.04 fe800fde-e922-4f2f-942d-53adf1ad9bce &lt;list[2]&gt;
#&gt;  3:       0.04 a3e8c06e-d17a-4bdc-ae57-b31c3b42ac64 &lt;list[2]&gt;
#&gt;  4:       0.70 dc9434a8-6969-439c-95fd-f6c3cc5f9e33 &lt;list[2]&gt;
#&gt;  5:       0.42 24801fd7-19f0-4767-b35c-2649ecbd5614 &lt;list[2]&gt;
#&gt;  6:       0.04 35cffda3-182d-48e0-aa93-5992bbadc866 &lt;list[2]&gt;
#&gt;  7:       0.04 1717984f-b681-4a4b-830f-e7a8bde65ba1 &lt;list[2]&gt;
#&gt;  8:       0.04 73f731be-4d8a-4f89-a16b-f0073a6712f1 &lt;list[2]&gt;
#&gt;  9:       0.04 f2a0f287-b16a-481a-a8ba-e3e96f61dfea &lt;list[2]&gt;
#&gt; 10:       0.04 a230e8e1-7a58-4195-a42f-8c4232a58c75 &lt;list[2]&gt;
#&gt; 11:       0.04 89c06155-ef25-45b8-bf3a-e6e7cb3352d5 &lt;list[2]&gt;
#&gt; 12:       0.04 743806c7-9560-429f-8c4d-c53480d2d70d &lt;list[2]&gt;
#&gt; 13:       0.42 0099167b-b3ca-4360-a2aa-29a1d4223f3e &lt;list[2]&gt;
#&gt; 14:       0.42 773e16a9-75fb-45cb-94cc-b7ac8f15d9c9 &lt;list[2]&gt;
#&gt; 15:       0.04 adb7cfc8-c6f9-4802-9d0f-458120bad717 &lt;list[2]&gt;
#&gt; 16:       0.42 c65281e3-e668-48d5-ba05-fa91a8823634 &lt;list[2]&gt;
#&gt; 17:       0.04 fb2f44d2-0903-4869-b667-9595f3d95d3f &lt;list[2]&gt;
#&gt; 18:       0.04 a6c48953-7293-4456-9bb4-6e2097c8e9d1 &lt;list[2]&gt;
#&gt; 19:       0.04 f4d11073-b6e4-484a-8651-02cd31d233cf &lt;list[2]&gt;
#&gt; 20:       0.04 17f37a30-2c3d-4149-87b0-a0db28e3b4f2 &lt;list[2]&gt;
#&gt; 21:       0.42 c8f82771-2a2a-49a0-bc4f-1e08d05c97f7 &lt;list[2]&gt;
#&gt; 22:       0.42 37c780f5-cb8a-41ef-8da7-55a4e7832c8d &lt;list[2]&gt;
#&gt; 23:       0.42 44651e9c-65fd-467b-b9d8-8bfa3206c52b &lt;list[2]&gt;
#&gt; 24:       0.42 56f58c3b-b6d4-4c97-8a85-7b70aaf1015c &lt;list[2]&gt;
#&gt; 25:       0.42 8b7bc73a-f0da-44e6-b692-693176d2fc70 &lt;list[2]&gt;
#&gt; 26:       0.42 375a7d88-6722-4b29-8507-dc8df9b523fa &lt;list[2]&gt;
#&gt; 27:       0.42 8652a0b2-1d81-4d68-af19-b33c5b4e3f79 &lt;list[2]&gt;
#&gt; 28:       0.42 e9d05a12-6d52-40de-aa4a-710eee81e630 &lt;list[2]&gt;
#&gt; 29:       0.04 b78cf3da-fb8e-42b2-9e42-d972b61f864a &lt;list[2]&gt;
#&gt; 30:       0.04 803a9fd0-87a4-4b5d-8ead-a2aedff5d76c &lt;list[2]&gt;
#&gt;     classif.ce                                uhash  x_domain
#&gt;               timestamp batch_nr
#&gt;  1: 2020-09-10 07:46:33        1
#&gt;  2: 2020-09-10 07:46:33        1
#&gt;  3: 2020-09-10 07:46:33        1
#&gt;  4: 2020-09-10 07:46:33        1
#&gt;  5: 2020-09-10 07:46:33        1
#&gt;  6: 2020-09-10 07:46:33        1
#&gt;  7: 2020-09-10 07:46:33        1
#&gt;  8: 2020-09-10 07:46:33        2
#&gt;  9: 2020-09-10 07:46:33        2
#&gt; 10: 2020-09-10 07:46:33        2
#&gt; 11: 2020-09-10 07:46:33        3
#&gt; 12: 2020-09-10 07:46:33        4
#&gt; 13: 2020-09-10 07:46:34        5
#&gt; 14: 2020-09-10 07:46:34        5
#&gt; 15: 2020-09-10 07:46:34        5
#&gt; 16: 2020-09-10 07:46:34        5
#&gt; 17: 2020-09-10 07:46:34        5
#&gt; 18: 2020-09-10 07:46:34        6
#&gt; 19: 2020-09-10 07:46:34        6
#&gt; 20: 2020-09-10 07:46:34        7
#&gt; 21: 2020-09-10 07:46:34        8
#&gt; 22: 2020-09-10 07:46:34        8
#&gt; 23: 2020-09-10 07:46:34        8
#&gt; 24: 2020-09-10 07:46:34        8
#&gt; 25: 2020-09-10 07:46:35        9
#&gt; 26: 2020-09-10 07:46:35        9
#&gt; 27: 2020-09-10 07:46:35       10
#&gt; 28: 2020-09-10 07:46:35       10
#&gt; 29: 2020-09-10 07:46:35       10
#&gt; 30: 2020-09-10 07:46:35       10
#&gt;               timestamp batch_nr</div><div class='input'><span class='co'># }</span>

<span class='co'>### use subsampling for budget</span>

<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='kw'><a href='https://mlr3pipelines.mlr-org.com'>mlr3pipelines</a></span>)
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>123</span>)
<span class='kw'>ll</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3pipelines.mlr-org.com//reference/po.html'>po</a></span>(<span class='st'>"subsample"</span>) <span class='op'>%&gt;&gt;%</span> <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>lrn</a></span>(<span class='st'>"classif.rpart"</span>)

<span class='co'># define with extended hyperparameters with subsampling fraction as budget</span>
<span class='co'># ==&gt; no learner budget is required</span>
<span class='kw'>params</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
  <span class='kw'>ParamDbl</span><span class='op'>$</span><span class='fu'>new</span>(<span class='st'>"classif.rpart.cp"</span>, lower = <span class='fl'>0.001</span>, upper = <span class='fl'>0.1</span>),
  <span class='kw'>ParamInt</span><span class='op'>$</span><span class='fu'>new</span>(<span class='st'>"classif.rpart.minsplit"</span>, lower = <span class='fl'>1</span>, upper = <span class='fl'>10</span>),
  <span class='kw'>ParamDbl</span><span class='op'>$</span><span class='fu'>new</span>(<span class='st'>"subsample.frac"</span>, lower = <span class='fl'>0.1</span>, upper = <span class='fl'>1</span>, tags = <span class='st'>"budget"</span>)
)

<span class='co'># define TuningInstanceSingleCrit with the Graph Learner and the extended hyperparams</span>
<span class='kw'>inst</span> <span class='op'>=</span> <span class='kw'>TuningInstanceSingleCrit</span><span class='op'>$</span><span class='fu'>new</span>(
  <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>tsk</a></span>(<span class='st'>"iris"</span>),
  <span class='kw'>ll</span>,
  <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>rsmp</a></span>(<span class='st'>"holdout"</span>),
  <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>msr</a></span>(<span class='st'>"classif.ce"</span>),
  <span class='kw'>ParamSet</span><span class='op'>$</span><span class='fu'>new</span>(<span class='kw'>params</span>),
  <span class='fu'><a href='https://mlr3tuning.mlr-org.com/reference/trm.html'>trm</a></span>(<span class='st'>"evals"</span>, n_evals = <span class='fl'>100000</span>)
)

<span class='co'># define and call hyperband as usual</span>
<span class='kw'>tuner</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3tuning.mlr-org.com/reference/tnr.html'>tnr</a></span>(<span class='st'>"hyperband"</span>, eta = <span class='fl'>4L</span>)
<span class='co'># \donttest{</span>
<span class='kw'>tuner</span><span class='op'>$</span><span class='fu'><a href='https://rdrr.io/r/stats/optimize.html'>optimize</a></span>(<span class='kw'>inst</span>)
</div><div class='output co'>#&gt;    classif.rpart.cp classif.rpart.minsplit subsample.frac learner_param_vals
#&gt; 1:       0.07348139                      3           0.25          &lt;list[6]&gt;
#&gt;     x_domain classif.ce
#&gt; 1: &lt;list[3]&gt;       0.02</div><div class='input'>
<span class='co'># return the best evaluation</span>
<span class='kw'>inst</span><span class='op'>$</span><span class='kw'>result</span>
</div><div class='output co'>#&gt;    classif.rpart.cp classif.rpart.minsplit subsample.frac learner_param_vals
#&gt; 1:       0.07348139                      3           0.25          &lt;list[6]&gt;
#&gt;     x_domain classif.ce
#&gt; 1: &lt;list[3]&gt;       0.02</div><div class='input'>
<span class='co'># print all evaluations</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='kw'>inst</span><span class='op'>$</span><span class='kw'>archive</span><span class='op'>$</span><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>())
</div><div class='output co'>#&gt;    classif.rpart.cp classif.rpart.minsplit subsample.frac bracket bracket_stage
#&gt; 1:       0.02532664                      4           0.25       1             0
#&gt; 2:       0.07348139                      3           0.25       1             0
#&gt; 3:       0.08489786                      2           0.25       1             0
#&gt; 4:       0.05025520                      4           0.25       1             0
#&gt; 5:       0.07348139                      3           1.00       1             1
#&gt; 6:       0.05762160                      5           1.00       0             0
#&gt; 7:       0.02247238                      3           1.00       0             0
#&gt;    budget_scaled budget_real n_configs classif.ce
#&gt; 1:           2.5        0.25         4       0.04
#&gt; 2:           2.5        0.25         4       0.02
#&gt; 3:           2.5        0.25         4       0.08
#&gt; 4:           2.5        0.25         4       0.02
#&gt; 5:          10.0        1.00         1       0.04
#&gt; 6:          10.0        1.00         2       0.04
#&gt; 7:          10.0        1.00         2       0.04
#&gt;                                   uhash  x_domain           timestamp batch_nr
#&gt; 1: 2c8546fa-1a53-4e0e-8caf-fb5686ad191a &lt;list[3]&gt; 2020-09-10 07:46:37        1
#&gt; 2: 15c7496f-65e0-441e-acd6-44f82c8be5a6 &lt;list[3]&gt; 2020-09-10 07:46:37        1
#&gt; 3: bca0e1e2-3061-429a-a65d-ab239f022819 &lt;list[3]&gt; 2020-09-10 07:46:37        1
#&gt; 4: 72b20beb-bb17-44fd-97dc-88666ff5180c &lt;list[3]&gt; 2020-09-10 07:46:37        1
#&gt; 5: 9f5e9f35-1820-4ae6-9666-72fcb9d1fd50 &lt;list[3]&gt; 2020-09-10 07:46:37        2
#&gt; 6: bcce80ac-5aeb-4ead-ae51-fbf3edf6bc34 &lt;list[3]&gt; 2020-09-10 07:46:38        3
#&gt; 7: f7ce43e2-9918-4b49-bd84-d9ae805075db &lt;list[3]&gt; 2020-09-10 07:46:38        3</div><div class='input'><span class='co'># }</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Marc Becker, Sebastian Gruber, Jakob Richter, Julia Moosbauer, Bernd Bischl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.0.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


